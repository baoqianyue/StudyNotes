# 如何设计出一个好的数据库模式      

针对于一个具体问题，应该如何构造一个适合于它的数据库模式，即应该构造几个关系模式，每个关系由哪些属性构成，这是数据库设计的问题，确切的说是关系数据库逻辑设计问题。     

由于关系模型有严格的数学理论基础，并且可以向别的数据模型切换，所以数据库逻辑设计的一个有利工具就是关系数据库的规范化理论。     

首先看一下关系模型的形式化定义：   
```
一个关系模式应该是一个五元组   
R(U,D,DOM,F)   
关系名R是符号化的元组定义    
U为一组属性    
D为属性组U中的属性所来自的域      
DOM为属性到域的映射     
F为属性组U的一组数据依赖      
```    
由于D、DOM与模式设计关系不大，这里吧关系模式看成是一个三元组：`R<U,F>`      
当且仅当U上的一个关系r满足F时，r成为关系模式R<U,F>的一个关系。     
作为一个二维表，关系要符合一个最基本的条件：每一个分量必须是不可分的数据项，满足了这个条件的关系模式就属于第一范式。         

为了能够设计出适当的数据模式，先要了解一下什么是数据依赖      

> 数据依赖是一个关系内部属性与属性之间的一种约束关系，这种约束关系是通过属性间值的相等与否体现出来的数据间相关联系。     

人们已经提出了很多种类型的数据依赖，其中最重要的是函数依赖(FD)和多值依赖(MVD).     


## 规范化    

* 函数依赖      
    设R(U)是属性集U上的关系模式，X，Y是U的子集，若对于R(U)的任意一个可能的关系r，r中不可能存在两个元组在X上的属性值相同，而在Y上的属性值不同，则称X函数确定Y或Y函数依赖于X，X -> Y.     
    
    函数依赖和别的数据依赖一样是语义范畴的概念，只能根据语义来确定一个函数依赖。     

    **注意：函数依赖不是指关系模式R的某个或某些关系满足的约束条件，而是关系模式R的一切关系都要满足的约束条件。**       

* 码    
    设K是关系模式R<U,F>中的属性或属性组，若U完全函数依赖于K，则称K为模式R的候选码。      

    注意这里是U完全函数依赖于K，如果是部分函数依赖，K称为超码，候选码是最小的超码。      

    如果候选码有多个，则选择其中的一个作为主码，候选码可以是一个属性也可以是一组属性，所以主码也可以是一组属性。     

    包含在候选码中的属性称为主属性，也叫码属性，不在候选码中的属性称为非主属性或非码属性。    

    最简单的情况是单个属性是码，最极端的情况，整个属性组是码，称为全码   

    关系模式R中属性或属性组X并非R的码，但X是另一个关系模式的码，则称X是R的外部码，也称外码。         


* 2NF    
    若一个关系模式R符合第一范式，且每一个非主属性都完全函数依赖于任何一个候选码，则R符合第二范式。      

    一个不符合2NF的关系模式需要进行拆分，可以使用投影分解成多个模式，保证每个模式中非主属性都是完全函数依赖于候选码的。     

    **可以将2NF看成是在1NF的基础上消除关系模式内部属性组之间的部分函数依赖** 

* 3NF      
    设关系模式R<U,F>满足第一范式，若R中不存在这样的码X，属性组Y及非主属性Z，使得X->Y，Y->Z成立，则称R<U,F>满足第三范式    

    由上面的定义可以得到，如果R满足3NF,则每一个非主属性既不传递函数依赖于候选码，也不部分函数依赖于候选码，也就是说如果R属于3NF，那么R必定也属于2NF。       

    **可以将3NF看成是在2NF基础上消除关系模式内部非主属性对码的传递函数依赖**    

* BCNF    
    关系模式R<U,F>属于1NF，若X->Y时，X必含有码，则关系模式R属于BCNF。
    
    也就是说关系模式R中，每一个决定因素中都含有码，则R属于BCNF。   

    > 若X->Y，则称X为这个函数依赖中的决定属性组，也称为决定因素。     

    由上面的定义我们可以得到以下结论：  
    
    * 所有非主属性对每一个码都是完全函数依赖    
    * 所有主属性对每一个不包含它的码也是完全函数依赖    
    * 没有任何属性完全函数依赖于非码的任何一组属性。      

    由于R属于BCNF，按定义拍出来任何属性对码的部分函数依赖和传递函数依赖，所以R必定属于3NF。      

    下面举几个例子：    

    1.关系模式SJP(S,J,P)中，S是学生，J表示课程，P表示名次，每一个学生选修每门课程的成绩有一定的名次，每门课程中每一名次只有一名学生(即没有并列名次)，由语义得到下列函数依赖：   

    `(S,J)->P,(J,P)->S`    

    所以(S,J),(J,P)都可以作为候选码，这两个候选码都由两个属性构成，而且他们是相交的，这个关系模式中显然没有属性对码传递依赖和部分函数依赖，所以SPJ属于第三范式，而且除了(S,J),(J,P)没有其他的决定因素，所以SJP属于BCNF。        

    2.关系模式STJ(S,T,J)中，S是学生，T是老师，J是课程，每一个老师只可以教一门课，每门课可以有多个老师，某一学生选定某门课，就对应一个固定的老师，由语义可得到下列函数依赖：   

    `(S,J)->T,(S,T)->J,T->J`    

    所以(S,J),(S,T)两个是候选码，很明显关系模式STJ中没有非主属性，所以也就不存在非主属性对候选码的部分函数依赖和传递函数依赖了，所以关系模式STJ属于3NF，但是STJ不属于BCNF，因为T是决定因素，但它不包含码。    
    也就是说BCNF是消除了主属性之间的部分函数依赖，STJ模式也可以通过模式分解达到BCNF，可以分解为ST(S,T)和TJ(T,J)，它们都是BCNF。   

    一个模式中的关系模式如果都属于BCNF，那么在函数依赖范畴内它已经实现了彻底的分离，已经消除了插入和删除的异常，3NF的不彻底性表现在可能存在主属性对码的部分函数依赖和传递函数依赖。
    